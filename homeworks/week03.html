<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week03</title>
  <style>
body {
font-family: Arial, sans-serif;
background: #f9f9f9;
color: #222;
margin: 40px;
}
h1 {
font-size: 1.6em;
margin-bottom: 0.2em;
}
h2 {
font-size: 1.2em;
margin-top: 1.5em;
border-bottom: 1px solid #ccc;
padding-bottom: 0.2em;
}
p {
margin: 0.3em 0 1em;
}
code {
background: #eee;
padding: 2px 4px;
border-radius: 3px;
font-size: 0.95em;
}
img {
display: block;
margin: 10px 0;
border: 1px solid #ccc;
border-radius: 4px;
width: 400px;
height: auto;
}
figcaption {
font-size: 0.9em;
color: #555;
margin-bottom: 1em;
}
</style>
</head>
<body>
<h2>RSA (p=17, q=19 → n=323) — direct ASCII mapping + frequency guess (no key)</h2>

<div>
  <label><strong>Plaintext</strong></label>
  <textarea id="plain" placeholder="Type text..."></textarea>
  <button id="encrypt">Encrypt</button>
</div>

<div style="margin-top:10px;">
  <label><strong>Ciphertext (gibberish ASCII)</strong></label>
  <textarea id="cipher" placeholder="Ciphertext appears here"></textarea>
</div>

<div style="margin-top:10px;">
  <button id="guess">Guess (frequency — no key)</button>
  <textarea id="guessed" placeholder="Guessed plaintext (no key)"></textarea>
</div>

<div style="margin-top:10px;">
  <button id="decrypt">Decrypt (known key)</button>
  <textarea id="decrypted" placeholder="Decrypted text (ground truth)"></textarea>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // --- Fixed tiny RSA ---
  const n = 17n * 19n;   // 323
  const e = 5n;
  const d = 173n;        // private exponent (not used by the guesser)

  // --- Modular exponentiation (BigInt) ---
  function modPow(base, exp, mod) {
    base = (base % mod + mod) % mod;
    let result = 1n;
    while (exp > 0n) {
      if (exp & 1n) result = (result * base) % mod;
      base = (base * base) % mod;
      exp >>= 1n;
    }
    return result;
  }

  // --- Encrypt: plaintext char -> ASCII -> m^e mod n -> ASCII char ---
  function encrypt(text) {
    let out = "";
    for (const ch of text) {
      const m = BigInt(ch.charCodeAt(0));
      const c = modPow(m, e, n);
      out += String.fromCharCode(Number(c));
    }
    return out;
  }

  // --- Decrypt (with key): ciphertext char -> ASCII -> c^d mod n -> ASCII char ---
  function decrypt(cipher) {
    let out = "";
    for (const ch of cipher) {
      const c = BigInt(ch.charCodeAt(0));
      const m = modPow(c, d, n);
      out += String.fromCharCode(Number(m));
    }
    return out;
  }

  // --- Guess (without key) using frequency rank mapping ---
  // Most frequent ciphertext char → ' ' (space) or 'e'? We'll prioritize 'e' as you said.
  // Single algorithm: rank-match ciphertext char frequencies to English frequency order.
  const FREQ_ORDER = ['e','t','a','o','i','n','s','h','r','d','l','u','c','m','f','w','y','g','p','b','v','k','x','q','j','z',' '];

  function guessByFrequency(cipher) {
    if (!cipher) return "";

    // 1) Count ciphertext character frequencies
    const freq = new Map();
    for (const ch of cipher) freq.set(ch, (freq.get(ch) || 0) + 1);

    // 2) Sort ciphertext characters by descending frequency
    const tokens = [...freq.keys()].sort((a,b) => freq.get(b) - freq.get(a));

    // 3) Build substitution: most frequent cipher char -> 'e', next -> 't', etc.
    const sub = new Map();
    for (let i = 0; i < tokens.length; i++) {
      sub.set(tokens[i], FREQ_ORDER[i] || '?');
    }

    // 4) Apply substitution to produce the guessed plaintext
    let out = "";
    for (const ch of cipher) out += (sub.get(ch) ?? '?');
    return out;
  }

  // --- Wire up UI ---
  const $ = sel => document.querySelector(sel);

  $("#encrypt").addEventListener("click", () => {
    $("#cipher").value = encrypt($("#plain").value || "");
  });

  $("#guess").addEventListener("click", () => {
    $("#guessed").value = guessByFrequency($("#cipher").value || "");
  });

  $("#decrypt").addEventListener("click", () => {
    $("#decrypted").value = decrypt($("#cipher").value || "");
  });
});
</script>

</body>
</html>
