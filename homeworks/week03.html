<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week03</title>
  <style>
body {
font-family: Arial, sans-serif;
background: #f9f9f9;
color: #222;
margin: 40px;
}
h1 {
font-size: 1.6em;
margin-bottom: 0.2em;
}
h2 {
font-size: 1.2em;
margin-top: 1.5em;
border-bottom: 1px solid #ccc;
padding-bottom: 0.2em;
}
p {
margin: 0.3em 0 1em;
}
code {
background: #eee;
padding: 2px 4px;
border-radius: 3px;
font-size: 0.95em;
}
img {
display: block;
margin: 10px 0;
border: 1px solid #ccc;
border-radius: 4px;
width: 400px;
height: auto;
}
figcaption {
font-size: 0.9em;
color: #555;
margin-bottom: 1em;
}
</style>
</head>
<body>
<h2>RSA (fixed p=3,q=7)</h2>

<div>
  <label><strong>Plaintext</strong></label>
  <textarea id="gf_plain" placeholder="Type some English text"></textarea>
  <button id="gf_encrypt">Encrypt → gibberish</button>
</div>

<div style="margin-top:10px;">
  <label><strong>Ciphertext (gibberish words, space-separated)</strong></label>
  <textarea id="gf_cipher" placeholder="Gibberish ciphertext appears here"></textarea>
</div>

<div style="margin-top:10px;">
  <button id="gf_attack">Guess plaintext (freq rank)</button>
  <textarea id="gf_guess" placeholder="Guessed plaintext appears here"></textarea>
  <div id="gf_report" class="muted"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Fixed RSA params: p=3,q=7 -> n=21, e=5
  const n = 21n;
  const e = 5n;

  // Deterministic gibberish tokens for ciphertext values 0..20
  // (21 tokens, unique, pronounceable-ish)
  const TOKENS = [
    "zab","mox","quf","xen","gol","tre","pib","suk","vra","lon",
    "keb","hix","dun","raf","sey","wog","bil","nor","jas","yem","toq"
  ];

  // English frequency rank order (space first)
  const FREQ_ASCII_ORDER = [
    ' ', 'E','T','A','O','N','I','H','S','R','D','L','U','M','C','W','F','Y','G','P','B','V','K','X','Q','J','Z'
  ];

  // BigInt modular exponentiation
  function modPow(base, exp, mod){
    base = (base % mod + mod) % mod;
    let result = 1n;
    let b = base;
    let eLocal = exp;
    while (eLocal > 0n){
      if (eLocal & 1n) result = (result * b) % mod;
      b = (b * b) % mod;
      eLocal >>= 1n;
    }
    return result;
  }

  // Encrypt plaintext -> gibberish tokens
  function encryptToGibberish(plain){
    const tokensOut = [];
    for (const ch of plain){
      const m = BigInt(ch.charCodeAt(0));         // ASCII / code unit
      const c = modPow(m, e, n);                 // c in 0..20
      const idx = Number(c);                     // safe: c small
      const tok = TOKENS[idx];                   // map integer -> token
      tokensOut.push(tok);
    }
    // join tokens with spaces (no numbers anywhere)
    return tokensOut.join(' ');
  }

  // Attack (no key) — single algorithm: frequency rank-matching on tokens
  function attackGibberish(cipherGibber){
    const parts = cipherGibber.trim().split(/\s+/).filter(Boolean);
    if (!parts.length) return { plain: "", note: "Empty ciphertext" };

    // count token frequencies
    const freq = new Map();
    for (const t of parts) freq.set(t, (freq.get(t) || 0) + 1);

    // tokens sorted by descending frequency
    const tokensSorted = [...freq.keys()].sort((a,b) => freq.get(b) - freq.get(a));

    // build substitution: most frequent token -> ' ' (space), next -> 'E', etc.
    const subMap = new Map();
    for (let i = 0; i < tokensSorted.length; i++){
      subMap.set(tokensSorted[i], FREQ_ASCII_ORDER[i] || '?');
    }

    // construct guessed plaintext by substituting each token
    let guess = "";
    for (const t of parts) {
      guess += (subMap.get(t) ?? '?');
    }

    // small report string
    const topPairs = tokensSorted.slice(0, Math.min(12, tokensSorted.length))
      .map(t => `${t}→${subMap.get(t)}(${freq.get(t)})`)
      .join(', ');

    return { plain: guess, note: `Top mapping: ${topPairs}` };
  }

  // UI wiring
  const $ = s => document.querySelector(s);
  $('#gf_encrypt').addEventListener('click', () => {
    const pt = $('#gf_plain').value || "";
    $('#gf_cipher').value = encryptToGibberish(pt);
    $('#gf_guess').value = ""; $('#gf_report').textContent = "";
  });

  $('#gf_attack').addEventListener('click', () => {
    const ct = $('#gf_cipher').value || "";
    const res = attackGibberish(ct);
    $('#gf_guess').value = res.plain;
    $('#gf_report').textContent = res.note;
  });
});
</script>

</body>
</html>
