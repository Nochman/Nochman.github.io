<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week03</title>
  <style>
body {
font-family: Arial, sans-serif;
background: #f9f9f9;
color: #222;
margin: 40px;
}
h1 {
font-size: 1.6em;
margin-bottom: 0.2em;
}
h2 {
font-size: 1.2em;
margin-top: 1.5em;
border-bottom: 1px solid #ccc;
padding-bottom: 0.2em;
}
p {
margin: 0.3em 0 1em;
}
code {
background: #eee;
padding: 2px 4px;
border-radius: 3px;
font-size: 0.95em;
}
img {
display: block;
margin: 10px 0;
border: 1px solid #ccc;
border-radius: 4px;
width: 400px;
height: auto;
}
figcaption {
font-size: 0.9em;
color: #555;
margin-bottom: 1em;
}
</style>
</head>
<body>
<h2>RSA (p=3,q=7) — ciphertext as ASCII letters</h2>
<p>Each character: m = char code, c = m^5 mod 21, then ciphertext char = ASCII(65 + c) (A..U). No integers displayed.</p>

<div>
  <label><strong>Plaintext</strong></label>
  <textarea id="pt" placeholder="Type English text here"></textarea>
  <button id="enc">Encrypt → ciphertext chars</button>
</div>

<div style="margin-top:10px;">
  <label><strong>Ciphertext (characters only)</strong></label>
  <textarea id="ct" placeholder="Ciphertext appears here (chars A..U)"></textarea>
</div>

<div style="margin-top:10px;">
  <button id="attack">Guess plaintext (frequency-rank)</button>
  <textarea id="guess" placeholder="Guessed plaintext appears here"></textarea>
  <div id="report" class="muted"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Fixed RSA params p=3,q=7 -> n=21, e=5
  const n = 21n;
  const e = 5n;

  // We map ciphertext integers 0..20 -> ASCII chars 'A'..'U'
  const BASE_CHAR_CODE = 65; // 'A'
  function intToCipherChar(i){ return String.fromCharCode(BASE_CHAR_CODE + i); }
  function cipherCharToInt(ch){ return ch.charCodeAt(0) - BASE_CHAR_CODE; } // 0..20

  // modPow (BigInt)
  function modPow(base, exp, mod){
    base = (base % mod + mod) % mod;
    let result = 1n;
    let b = base;
    let eLocal = exp;
    while (eLocal > 0n){
      if (eLocal & 1n) result = (result * b) % mod;
      b = (b * b) % mod;
      eLocal >>= 1n;
    }
    return result;
  }

  // --- Encryption: plaintext -> ciphertext chars ---
  function encryptPlainToChars(plain){
    const out = [];
    for (const ch of plain){
      const m = BigInt(ch.charCodeAt(0));    // plaintext code (ASCII / UTF-16 code unit)
      const c = modPow(m, e, n);             // c in 0..20
      const idx = Number(c);                 // safe: small
      out.push(intToCipherChar(idx));        // map integer -> char 'A'..'U'
    }
    return out.join(''); // contiguous chars
  }

  // --- Attack (single algorithm): frequency rank matching ---
  // Frequency order (space first, then letters): single algorithm only.
  const FREQ_ORDER = [' ', 'E','T','A','O','N','I','H','S','R','D','L','U','M','C','W','F','Y','G','P','B','V','K','X','Q','J','Z'];

  function attackByRankOnChars(cipherChars){
    // cipherChars: string, characters from 'A'..'U' corresponding to c values
    if (!cipherChars || cipherChars.length === 0) return {plain:"", note:"Empty ciphertext"};

    // Count token (char) frequencies
    const freq = new Map();
    for (const ch of cipherChars){
      freq.set(ch, (freq.get(ch)||0) + 1);
    }

    // Sort ciphertext characters by descending frequency
    const tokens = [...freq.keys()].sort((a,b) => freq.get(b) - freq.get(a));

    // Map most frequent ciphertext char -> ' ' (space), next -> 'E', next -> 'T', ...
    const mapC2P = new Map();
    for (let i=0; i<tokens.length; i++){
      mapC2P.set(tokens[i], FREQ_ORDER[i] || '?');
    }

    // Apply mapping to the whole ciphertext to produce guessed plaintext
    let out = "";
    for (const ch of cipherChars){
      out += (mapC2P.get(ch) ?? '?');
    }

    const topMapPreview = tokens.slice(0, Math.min(10,tokens.length)).map(t => `${t}→${mapC2P.get(t)}(${freq.get(t)})`).join(', ');
    return { plain: out, map: mapC2P, note: `Top mapping: ${topMapPreview}` };
  }

  // --- UI wiring ---
  const $ = sel => document.querySelector(sel);
  $('#enc').addEventListener('click', () => {
    const pt = $('#pt').value || "";
    $('#ct').value = encryptPlainToChars(pt);
    $('#guess').value = "";
    $('#report').textContent = "";
  });

  $('#attack').addEventListener('click', () => {
    const ct = $('#ct').value || "";
    const res = attackByRankOnChars(ct);
    $('#guess').value = res.plain;
    $('#report').textContent = res.note;
  });

});
</script>

</body>
</html>
